syntax = "proto3";
// for proxy
import "google/api/annotations.proto";
import "book.proto";

// protoファイルで定義したメッセージ型
// required, option, ...とかがproto2のみ必要だった。proto1からproto3でproto2のみイレギュラー担ってて厄介なのでproto3でよくね。

option go_package = "./pkg/grpc";

// packageの宣言
package myapp;

// 図書館のアカウント
message Account {
  // 借りる人の名前
  string name = 1;
}

// 図書館のアカウント
message Accounts {
  // 借りる人の名前
  repeated string names = 1;
}

// 貸し出し状況
message AccountInfo {
  // 借りた人の名前
  string name = 1;
  // 借りている本一覧
  Books books = 2;
}

// 貸し出しリクエスト
message BorrowRequest {
  //　本を借りるアカウント
  Account account = 1;
  //　借りたい本
  Book book = 2;
}

message BorrrowResponse {
  //　本を借りたアカウント
  Account account = 1;
  //　借りた本
  Book book = 2;
}


// 本の貸し出しサービス
service LendingBooksService {
  // 本を借りるためのメソッド
  rpc SendBorrow (BorrowRequest) returns (BorrrowResponse);
  
  // 本の名前を指定すると、借りている人の名前一覧が取得できる
  rpc ShowBookInfo (Book) returns (Accounts) {
    option (google.api.http) = {
      post: "/v1/info/book"
      body: "*"
    };
  }
}

